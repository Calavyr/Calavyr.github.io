<head>
<title>Bad URL Shortener</title>
</head>

<body>
<div id="inputs">

</div>
<button id="addInput">Add link</button>
<button id="generateLink">Generate Link</button>
<div id="linkOutput">

</div>
</body>

<script>
var inputs = document.getElementById("inputs")
var addInput = document.getElementById("addInput")
var generateLink = document.getElementById("generateLink")
var linkOutput = document.getElementById("linkOutput")

addInput.addEventListener("click", function() {
	inputs.innerHTML += "\n<input type='text' />"
})

generateLink.addEventListener("click", function() {
	var links = ""
	var children = inputs.children
	for (let i = 0; i < children.length; i++) {
		if (children[i].value.length ~= 0) {
			if (i ~= 0) {
				links += "---"
			}
			links += children[i].value
		}
	}
	linkOutput.innerHTML = "Here's your link:\n" + insertParam('links', links)
})


function insertParam(key, value) {
    key = encodeURIComponent(key);
    value = encodeURIComponent(value);

    // kvp looks like ['key1=value1', 'key2=value2', ...]
    var kvp = document.location.search.substr(1).split('&');
    let i=0;

    for(; i<kvp.length; i++){
        if (kvp[i].startsWith(key + '=')) {
            let pair = kvp[i].split('=');
            pair[1] = value;
            kvp[i] = pair.join('=');
            break;
        }
    }

    if(i >= kvp.length){
        kvp[kvp.length] = [key,value].join('=');
    }

    let params = kvp.join('&');

    //document.location.search = params;
	return params
}
</script>
